create table file_types
(
    name        varchar(100)                                           not null
        primary key,
    description varchar(500),
    created_at  timestamp with time zone default statement_timestamp() not null,
    updated_at  timestamp with time zone default statement_timestamp() not null
);

alter table file_types
    owner to postgres;

create table file_nodes
(
    id             integer generated by default as identity
        constraint "PK_file_nodes"
            primary key,
    title          varchar(256)                                           not null,
    file_type_name varchar(100)                                           not null
        constraint file_nodes_file_types_name_fk
            references file_types
            on delete cascade,
    parent_id      integer
        constraint file_nodes_file_nodes_id_fk
            references file_nodes,
    created_at     timestamp with time zone default statement_timestamp() not null,
    updated_at     timestamp with time zone default statement_timestamp() not null
);

alter table file_nodes
    owner to postgres;

create unique index file_nodes_title_file_type_name_parent_id_uindex
    on file_nodes (title, file_type_name, parent_id)
    where (parent_id IS NULL);

create unique index file_nodes_title_parent_id_file_type_name_uindex
    on file_nodes (title, parent_id, file_type_name)
    where (parent_id IS NOT NULL);

create index "IX_file_nodes_file_type_name"
    on file_nodes (file_type_name);

create index "IX_file_nodes_parent_id"
    on file_nodes (parent_id);

